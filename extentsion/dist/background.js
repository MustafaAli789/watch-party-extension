(()=>{"use strict";var e={714:(e,t)=>{var a,s;Object.defineProperty(t,"__esModule",{value:!0}),t.TabsStorage=t.Messages=t.Page=void 0,(s=t.Page||(t.Page={}))[s.START=0]="START",s[s.MAIN=1]="MAIN",(a=t.Messages||(t.Messages={}))[a.TOBG_VIDEO_ON_SCREEN=0]="TOBG_VIDEO_ON_SCREEN",a[a.SUCCESS=1]="SUCCESS",a[a.FAILURE=2]="FAILURE",a[a.TOBG_CREATE_ROOM_IN_TAB=3]="TOBG_CREATE_ROOM_IN_TAB",a[a.TOFG_VIDEO_ON_SCREEN=4]="TOFG_VIDEO_ON_SCREEN",a[a.TOFG_CREATE_ROOM_IN_TAB=5]="TOFG_CREATE_ROOM_IN_TAB",a[a.TOBG_DISCONNECT=6]="TOBG_DISCONNECT",a[a.TOFG_DISCONNECT=7]="TOFG_DISCONNECT",a[a.TOFG_RETRIEVE_ROOM_DATA=8]="TOFG_RETRIEVE_ROOM_DATA",t.TabsStorage="active_tabs_watchparty"}},t={};function a(s){var o=t[s];if(void 0!==o)return o.exports;var r=t[s]={exports:{}};return e[s](r,r.exports,a),r.exports}(()=>{const e=a(714);chrome.runtime.onInstalled.addListener((()=>{let e;e={},e.tabs=[],t(e)}));const t=t=>{chrome.storage.local.set({[e.TabsStorage]:t})},s=(a,s)=>{chrome.storage.local.get(e.TabsStorage,(o=>{let r=Object.assign({},o[e.TabsStorage]);r.tabs.forEach((e=>e.active=!1)),chrome.tabs.query({},(c=>{for(let e=r.tabs.length-1;e>=0;e--){let t=r.tabs[e];null==c.find((e=>e.id==t.id))&&r.tabs.splice(e,1)}let O=o[e.TabsStorage].tabs.find((e=>e.id===a));O&&"onUpdated"!==s?(r.tabs.forEach((e=>{e.id==a?e.active=!0:e.active=!1})),console.log(s)):chrome.scripting.executeScript({target:{tabId:a},files:["./socketio/socket.io.js"]}).then((()=>{chrome.scripting.executeScript({target:{tabId:a},files:["./foreground.js"]}).then((()=>{O?"onUpdated"===s&&(r.tabs.find((e=>e.id===a)).active=!0,t(r)):(r.tabs.push({id:a,channelOpen:!1,active:!0}),t(r),console.log(s))}))})).catch((e=>console.log(e))),t(r)}))}))};chrome.tabs.onActivated.addListener((e=>{s(e.tabId,"onActivated")})),chrome.tabs.onUpdated.addListener(((e,t,a)=>{"complete"===t.status&&s(e,"onUpdated")})),chrome.runtime.onMessage.addListener(((a,s,o)=>{chrome.storage.local.get(e.TabsStorage,(s=>{let o=Object.assign({},s[e.TabsStorage]);a.message===e.Messages.TOBG_CREATE_ROOM_IN_TAB?o.tabs.find((e=>e.active)).channelOpen=!0:a.message===e.Messages.TOBG_DISCONNECT&&(o.tabs.find((e=>e.active)).channelOpen=!1),t(o)}))}))})()})();